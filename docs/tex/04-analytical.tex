\chapter{Аналитическая часть}

\section{Одежда, как объект физического мира}

Любая одежда: футболки, брюки, носки, шарфы и куртки и т.~д., --- представляeт
собой одну или несколько соединенных между собой деталей из ткани. Ткань, в свою
очередь, состоит из натуральных или искусственных волокон или нитей, которые
производятся путем прядения различных материалов, таких как шерсть, хлопок,
лен~и~т.~п. Для соединения полученных волокон используют следующие техники:
\begin{itemize}[left=\parindent]
    \item ткачество --- изготовление ткани путем переплетения нитей под прямым
        углом (рисунок \ref{img:wrap});
    \item вязание --- соедение волокон между собой путем образования и
        протягивания петель (рисунок \ref{img:knit});
    \item макраме --- закрепление нитей с помощью узлов;
    \item прессование волокон животных (получение войлока).
\end{itemize}
После применения одной из этих техник получается готовая ткань.

\twoimg{40mm}{img01}{Строение тканного
полотна~\cite{imgSite01}}{wrap}{img02}{Строение вязаного
полотна~\cite{imgSite01}}{knit}

Разные волоконные материалы и техники их соединения являются причиной различной
степени проявления разными тканями основных механических свойств: растяжения,
сдвига и изгиба. Отсутствие у тканных материалов упругих свойств приводит к
образованию складок и легком драпировании на другие объекты. Таким образом,
разное строение ткани в зависимости от типа волокон, большое количество узлов,
из которых она состоит, разные степени проявления механических свойств, большое
количество степеней свободы -- все это следует учитывать при моделировании
ткани. Вследствие отсутствия возможности учесть все необходимые параметры ткани
разрабатываются упрощенные модели и методы их реализации для решения конкретных
задач: в одних целью является максимальная реалистичность изображения, в других
--- высокая скорость работы с наименьшей потерей реалистичности~\cite{bib11}.

\section{Методы визуализации одежды}

Как уже было сказано выше, одежда является более сложной формой ткани,
поэтому далее будут рассмотрены методы моделирования тканных материалов.
Данные методы можно разделить на два основных типа:
\begin{itemize}[left=\parindent]
    \item геометрические методы;
    \item физические методы.
\end{itemize}

\subsection{Геометрические методы}

Геометрические методы~\cite{bib07} не учитывают физические свойства ткани, они
фокусируются на воспроизведении внешнего вида тканных материалов с помощью
представления поверхности математическими функциями. Таким образом, в данных
методах не требуется решение сложных систем уравнений, что дает им преимущество
в виде большой скорости выполнения.

Хотя геометрические методы за короткое время могут с достаточной долей
реалистичности визуализировать ткань, каждый из них либо решает достаточно
специфическую задачу, например, воспроизведение висящей ткани или моделирование
складок на рукаве, либо нуждается в активном содействии пользователя, что
уменьшает количество сфер, в которых их можно применить.

\subsubsection{Метод моделирования свисающей ткани}
Метод моделирования свисающей ткани~\cite{bib08} предназначен для моделирования
тканного материала, который закреплен на некотором количестве точек. Ткань
считается прямоугольной и представляется в виде сетки, а моделирование
выполняется в два этапа:
\begin{enumerate}[label=\arabic*)]
    \item На первом этапе каждая пара заданных точeк соединяется цепной кривой,
        представленной формулой~(\ref{eq:01}):

        \begin{equation}\label{eq:01}
            y = a\cosh(\frac{x}{a}),
        \end{equation}

        где $a$ --- коэффициент масштабрирования.

        Если при этом проекции двух кривых на плоскость $XOZ$ пересекаются как
        показано на рисунке \ref{img:Weil}, то для устранения дополнительных
        вычислений, нижняя кривая удаляется. После заверешения этого этапа
        модель представляет изогнутый каркас, форма которого только приближается
        к структуре ткани. 

        \img{5cm}{img03}{Две пересекающиеся цепные кривые}{Weil}

    \item Для получения более точной модели добавляются новые поверхности,
        которые создаются путем разделения треугольников, образованных цепными
        кривыми, вычисленных на предыдущем этапе.  Новые треугольники также
        разделяются. Итерационный процесс продолжается до тех пор, пока
        максимальное смещение точек сетки за один проход не станет меньше
        заданного значения.
\end{enumerate}

После завершения двух этапов полученная модель визуализируется с
предварительным нанесением на нее сплайновый кривых для получения
гладкого изобажения ткани~\cite{bib07, bib08}.

\subsubsection{Метод моделирования складок на рукаве}

Метод моделирования складок на рукаве~\cite{bib07} ориентирован под конкретную
задачу, а именно моделирование рукава на сгибающейся руке.  Ткань представляется
в виде полого цилиндра, состоящего из набора окружностей~$R_i$~(рисунок
\ref{img:Agui01}). Складки образуются в том случае, если модуль разности
расстояний между точками двух соседних окружностей до ($L_0$) и после
($L_{i,j}$) деформации (рисунок \ref{img:Agui02})
меньше некоторого заранее заданного порогового значения. Складки моделируются
путем преобразования окружностей в многоугольники и изменения положения их
вершин~\cite{bib07}.

\img{5cm}{img04}{Модель рукава: полый цилиндр из набора окружностей}{Agui01}
\img{5cm}{img05}{Одна секция рукава до и после деформации}{Agui02}

\subsubsection{Методы со значительной степенью вмешательства пользователя}

Методы со значительной степенью вмешательства пользователя~\cite{bib09, bib10}
разрабатывались специально под графические редакторы. Основная их идея состоит в
том, чтобы изначально представить одежду как полностью прилегающую к телу или
расположенную на небольшом расстоянии с повторением контуров тела, а далее
предоставить пользователю интерфейс для редактирования положения ткани.  Так как
в данных методах реалистичность итового изображения во многом зависит от
пользователя, а в этой работе ставится задача получения реалистичного
изображения без его вмешательства, более подробное описание этих методов здесь
не приводится.

\subsection{Физические методы}

В физических методах~\cite{bib07} модель ткани представляют в виде треугольных
или прямоугольных сеток с точечными массами в узлах. Взаимодействие между этими
массами  описываются различными способами в зависимости от метода. В моделях,
основанных на энергии, положение точки определяется энергетическим состоянием
системы, а именно: ищется такое состояние ткани, в котором энергия системы
минимальна. В других моделях силы взаимодействия между точечными массами
описываются дифференциальными уравнениями, решение которых производится с
помощью численного интегрирования, в результате чего получают координаты точки.

Так как в физических методах проводится большое количество вычислений: решение
системы дифференциальных уравнений или перебор состояний системы для поиска
минимумов энергии, --- скорость их выполнения ниже, чем у геометрических
методов. Однако физические методы предоставляют большую свободу: мы можем
создать реалистичное изображение без привлечения пользователя, а также можем
смоделировать разные виды ткани, изменяя физические характеристики (например,
увеличение значения массы в узлах приведет к утяжелению ткани), что также
позволяет сделать модель более правдоподобной.

\subsubsection{Модель сплошной среды}

В модели сплошной среды ткань рассматривается в виде сплошной, однородной
структуры. Ее поведение моделируется с помощью теории упругости, из физически
обоснованных выражений которой выводится большая система обыкновенных
дифференциальных уравнений. Решение этой системы производится численно. Такой
подход позволяет модели естественным образом реагировать на приложенные силы,
окружающую среду и другие объекты, однако требует дорогих вычислительных
затрат~\cite{bib12, bib15}.

\subsubsection{Энергетическая модель системы частиц}

В методе энергетической модели системы частиц~\cite{bib13} точки пересечения
нитей ткани рассматриваются как точечные массы или частицы, а моделирование
состоит из двух этапов. На первом этапе учитывается гравитация и  определяются
любые столкновения с объектами или землей. Позиции частиц определются с помощью
уравнения, описывающегося формулой~(\ref{eq:02}):

\begin{equation}\label{eq:02}
    m\vec{a}+c\vec{v}=m\vec{g},
\end{equation}

где $m$ --- масса частицы,

~~~~~~$\vec{a}$ --- вектор ускорения,

~~~~~~$c$ --- сопротивление воздуха,

~~~~~~$\vec{v}$ --- вектор скорости,

~~~~~~$\vec{g}$ --- вектор ускорения свободного падения.

После первого этапа получается грубая модель ткани. Для получения реалистичного
изображения вводят второй этап, на котором минимизируется энергия системы
частиц, где энергия каждой частицы $U_i$ представляется, как сумма энергий
основных взаимодействий отталкивания $U_{repel_i}$, растяжения $U_{stretch_i}$,
сдвига $U_{shear_i}$, изгиба $U_{bend_i}$ и гравитации
$U_{gravity_i}$, что описано формулой~(\ref{eq:03})~\cite{bib07}:

\begin{equation}\label{eq:03}
U_i=U_{repel_i}+U_{stretch_i}+U_{shear_i}+U_{bend_i}+U_{gravity_i}.
\end{equation}

С помощью этого метода достигается реалистичность итогового изображения, однако
для поиска минимума энергии требуются большие временные затраты~\cite{bib11}.

\subsubsection{Массо-пружинная модель}

В массо-пружинной модели ткань также представляется в виде сетки с точечными
массами в узлах, но частицы между собой связаны пружинами, которые отвечают за
упругое поведение материала (рисунок~\ref{img:Provot}). Такое представления
ткани практично, так как криволинейные поверхности часто представляются
полигональными сетками, вершины которых можно рассматривать, как точечные массы,
а ребра --- как пружины~\cite{bib15}. Каждая пружина в этой модели относится к
одному из типов~\cite{bib14}:
\begin{itemize}[left=\parindent]
    \item пружины структуры ткани соединяют частицы с индексами $[i,j]$
        и $[i+1,j]$, а также $[i,j]$ и $[i, j+1]$;
    \item пружины сдвига ткани соединяют частицы с индексами $[i,j]$ и
        $[i+1,j+1]$, а также $[i+1,j]$ и $[i, j+1]$;
    \item пружины изгиба ткани соединяют частицы с индексами $[i,j]$ и
        $[i+2,j]$, а также $[i,j]$ и $[i, j+2]$.
\end{itemize}

\img{5cm}{img06}{Сетка масс и пружин}{Provot}

После представления ткани в виде сетки для каждой точки вычисляется
результирующая сила, вычисляемая путем сложения внутренних и внешних сил, а
положение точки определяется путем явного интегрирования полученных
уравнений~\cite{bib11}. Так как данный метод предназначен для анимации ткани,
скорость вычислений в нем выше, чем в ранее описанных методах~\cite{bib14}.

\subsection*{Вывод}

На основе поставленных целей и задач для визуализации одежды была выбрана
массо-пружинная модель ткани. Этот метод, как физический, имеет преимущество
перед геометрическими, так как он универсален, а реалистичность итогового
изображения не зависит от действий пользователя. Среди физических эта модель
выделяется скоростью работы, которая требуется для создания динамического
изображения и взаимодействия с пользователем. Также эта модель является
интуитивно понятной в силу базовых физических законов, лежащий в ее основе, что
является преимуществом как для реализации, так и для построения понятного для
пользователя интерфейса.

\section{Описание реализуемого метода}

Силы...

\section{Формализация модели}

Основным элементом сцены является футболка, которая, как и в реальной
жизни, состоит из нескольких частей --- выкроек. Для упрощения моделирования
футболка представляется в виде двух одинаковых частей, каждая из которых
является сеткой из масс и пружин. В силу возможности первоначального
расположения масс по квадратной сетки, форма выкроек задается матрицей, в
которой единица соответствует наличию массы, ноль --- ее отсутствию. Соединение
частей происходит с помощью введения дополнительных пружин у частиц
расположенных по местам швов.

Свойства тканного материала могут быть описаны массой узлов сетки и жесткостью
пружин, а также коэффициентами рассеянного и зеркального отражения света
от точечного источника света.

Таким образом, модель футболки описывается следующими параметрами:
\begin{itemize}
    \item форма частей --- матрица из нулей и единиц;
    \item масса узла сетки $m$ --- вещественное число от 0.001 до 1 (граммы);
    \item жесткость пружины $k$ --- целое число от 100 до 25000 (ньютон/метр);
    \item коэффициент рассеянного отражения --- вещественное число от 0 до 1;
    \item коэффициент зеркального отражения --- вещественное число от 0 до 1.
\end{itemize}

\section{Выбор методы рендера изображения}

\subsection{OpenGL}

\subsection{Vulkan}

\subsection{DirectX}

\subsection*{Вывод}

\section{Существующие программные обеспечения}

Реалистичная визуализация одежды является восстребованной в современном мире.
Так, она используется в профессиональных коммерческих программных обеспечениях
для индустрии моды, таких как Clo\cite{site01} (рисунок \ref{img:Clo}),
Browzwear\cite{site02} (рисунок \ref{img:Browzwear}).

\twoimg{50mm}{img13}{Пример работы программы Clo}{Clo}{img14}{Пример работы
программы Browzwear}{Browzwear}

Не являются исключением и бесплатные кроссплатформенные приложения для работы с
3D графикой, таких как Blender. Даное приложение предоставляет большой
функционал для моделирования, симуляции, рендеринга, монтажа, записи видео и
создания игр. Дополнения к Blender упрощают моделирование тех, или иных
объектов. В том числе существует дополнение для моделирования ткани и одежды,
пример которого представлен на рисунке \ref{img:blender}.

\img{6cm}{img15.jpg}{Пример визуализации одежды в Blender}{blender}

Также существует аппаратная реализация визуализации одежды PhysiX
Clothing\cite{site03}, пример работы которой представлен на рисунке
\ref{img:physix}.

\img{6cm}{img16.jpg}{Пример визуализации одежды PhysiX Clothing}{physix}

\section*{Вывод}

